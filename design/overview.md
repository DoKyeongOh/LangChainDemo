# 📚 규정 검색 챗봇 프로젝트 통합 가이드 (Project Master Manual)

본 문서는 Java 기반의 조직 내 규정 검색 RAG(Retrieval-Augmented Generation) 시스템의 전체 설계 및 데이터 흐름을 정의합니다.

---

## 1. 프로젝트 개요 (Overview)

* **목표**: 비정형 규정 문서에서 사용자의 질문에 부합하는 정확한 조항(제n조 n항)을 찾아 근거 기반의 답변을 제공함
* **핵심 전략**:
    * **Pre-filtering**: Vector DB의 메타데이터(키워드, 날짜 등)를 활용한 검색 범위 최적화
    * **Data Enrichment**: RDB 조회를 통한 실시간 유효성 검증 및 상세 출처 정보 보강
    * **Observability**: 검색 결과와 필터링 생존율 로깅을 통한 시스템 품질 모니터링

---

## 📊 2. ER 모델 (Entity Relationship)

데이터의 성격에 따라 4가지 계층으로 저장소를 분리 운영하며, 키워드는 별도 테이블 없이 메타데이터 필드에 통합 관리합니다.

### **A. RDB (영구 저장소: 마스터 데이터)**
* **규정 메타데이터**: id(PK), 문서이름, 등록일, 등록유저id
  (참고: 규정 종류 및 상세 속성은 필요 시 본 테이블의 컬럼으로 확장)

### **B. Vector DB (인덱싱: 고속 탐색 및 필터링)**
* **데이터 구성**: 임베딩 벡터, 원문 텍스트(Chunk)
* **메타데이터 필드**: 키워드 리스트(List), 문서등록일, 문서이름, document_id(Mapping Key)

### **C. Memory (휘발성: 질의 분석 및 라우팅)**
* **질의 분석 DTO**: 사용자ID, 사용자 의도(Intent), 질의 원문, 질문 키워드 리스트

### **D. File System (이력 관리: JSON)**
* **사용자 질의 히스토리 (history.json)**: 세션ID, 질의 원문, 일시, 응답 내용
* **사용자 질의 세션 (session.json)**: id, 제목, 생성일, 마지막 활동 일시

---

## 🔄 3. 데이터 흐름도 (DFD Overview)

시스템은 아래 4단계의 독립적인 프로세스로 순환됩니다.

### **[P 1.0] 규정 문서 전처리 및 인덱싱**
* **동작**: 파일 업로드 → 텍스트 추출 → 조항 단위 분할 → LLM 메타데이터(키워드 포함) 추출 → RDB/Vector DB 적재
* **핵심**: 키워드를 별도 테이블이 아닌 Vector DB의 메타데이터 필드로 직접 삽입하여 검색 효율 증대


### **[P 2.0] 사용자 질의 분석**
* **동작**: 자연어 질문 분석 → 의도(Intent) 파악 → 필터링용 키워드 및 엔티티 추출 → 분석 DTO 생성
* **핵심**: 사용자의 모호한 질문을 Vector DB 메타데이터 조건에 부합하는 구조적 데이터로 정규화


### **[P 3.0] 관련 정보 검색 및 필터링**
* **동작**: 메타데이터 Pre-filtering → 유사도 검색 → RDB 교차 검증(최신 상태 확인) 및 상세 정보 결합
* **핵심**: 오버샘플링을 통해 사후 필터링 시 발생할 수 있는 데이터 누락 리스크 방지


### **[P 4.0] 응답 생성 및 이력 관리**
* **동작**: 컨텍스트 기반 답변 생성 → 사용자 응답 → 세션 상태 및 질의 히스토리 JSON 업데이트
* **핵심**: 근거 조항(제n조 n항)을 반드시 포함하고, 답변 신뢰성을 위해 RDB의 상세 메타데이터 활용


---

## ✅ 4. 구현 핵심 체크리스트

* [ ] RDB `id`와 Vector DB의 `document_id` 간의 정합성 유지 로직
* [ ] LLM을 통한 조항별 키워드 추출 및 Vector DB 메타데이터 삽입 자동화
* [ ] 질문 분석 결과(DTO)를 바탕으로 한 동적 메타데이터 필터링 쿼리 생성
* [ ] JSON 기반 히스토리 파일의 입출력 예외 처리 및 비동기 기록 로직

---